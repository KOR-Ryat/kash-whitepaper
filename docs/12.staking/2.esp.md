---
sidebar_position: 2
---

# Early Staking Pool

이 페이지에서는 KASH 생태계의 첫번째 스테이킹 풀인 Early Staking Pool의 특징을 설명합니다. 이는 초기 세일즈 참여자에 대한 보상 지급목적의 풀입니다.

:::note
탐사 완료 시점 부근에 추가적인 세일즈가 현재 계획되어 있습니다. 그러나 보상 분배 계획 등 추가 세일즈를 위한 정책은 아직 확정되지 않았습니다. 따라서 이 문서는 초기 세일즈를 위한, 첫번째 스테이킹 풀인 Early Staking Pool에 한정한 시스템 내용을 담고 있습니다. 
:::

# Early Participant Bonus

Early Staking Pool에서는 세일즈 참여에 따른 추가적인 수익을 제공하기 위해 아래와 같이 EPB/DCR 등의 장치를 사용합니다.

---

### Early Participant Bonus

<!-- 이 문서에서는 편의상 세일즈(토큰 판매)를 다음과 같이 구분하여 분류합니다. 

+ Token Sales Stage
    + 초기 세일즈 : 프로젝트가 가동되기 위한 최소 조건인, 최초 5,000,000개 까지의 KASH 판매
    + 추가 세일즈 : 초기 세일즈 이후 5,000,000개의 KASH 판매. 즉, 5,000,001번째 ~ 10,000,000번째 KASH 판매까지
    + 기타 발행량 : 시장 상황에 따라 PoL 혹은 RBS에 의한 가격 안정화를 위해 채권 시장을 통해 발행한 KASH

Early Staking Pool은 이 중 더 불확실성이 높고, 프로젝트에 보다 큰 공헌을 한 초기 세일즈 참여자들에 대해 최대한의 보상 분배를, 추가 세일즈 참여자에게도 합리적인 수준의 보상을 지급 하는 것에 초점을 두고 설계 되었습니다. -->

프로토콜은 각 세일즈 참여자들에게 그 참여 시기(판매량 기준)에 따라 EPB라는 값을 부여합니다. 판매량이 낮은 초기에 참여한 사용자들일수록, 높은 리스크에 걸맞은 높은 EPB를 부여합니다.

+ $EPB$, Early Participant Bonus : 세일즈 참여 시기에 따른 보너스 배율
    $$
    EPB_{q} = A / (q + k)^2 + C
    $$
    + $q$ : 세일즈의 진행 상황 (판매량, KASH)
    + $k, A, C$ : 아래 조건을 달성하는 EPB 곡선을 구성하는 상수, 각 스테이킹 풀 별로 상이
        + 단조 감소 : $q_1<q_2 \implies EPB_{q1} \ge EPB_{q2}$
        + 목표 배율 : $EPB_0 = a$, $EPB_{5m} = b + \epsilon$
            + $a$ : 세일즈 초기의 최대 배율
            + $b$ : 세일즈 후기의 최소 배율
        + 정적분 : $\int_{0}^{5m} EPB_q \, dq = c - \epsilon$
            + $c$ : 세일즈를 통해 발행할 지분 총량
        + 소수점 오차 : $0< \epsilon ≪ 1$
    
+ $E(EPB)$ : 참여시기와 구매량을 고려한 실질적인 사용자의 최종 EPB.
    $$
    E(EPB) = \frac{1}{q_a - q_b} \int_{q_b}^{q_a} EPB_q \, dq
    $$
    + $q_b$ : 사용자가 토큰을 구매하기 전의 판매량
    + $q_a$ : 사용자가 토큰을 구매하고난 후의 판매량
    + 문서 내 사용자의 EPB 혹은 (판매량 가중, 적분) 평균 EPB 등은 이 E(EPB)를 뜻합니다.

이는 프로토콜이 참여자에게 제공하고자 목표하는 수익률을 의미하며, 실질적으로는 아래 DCR 등을 활용하여 가상의 지분을 지급하여 실현됩니다.

---

### Debt Creation Right

세일즈 참여자들은 구매량과 EPB에 비례해 부채를 만들 수 있는 권리인 DCR을 얻게 됩니다. 이 권리는 스테이킹에 토큰을 예치할 때 사용하여, 부채로 이루어진 가상의 지분을 부여받아 보상에 대한 지분율이 증가하는 효과를 얻을 수 있습니다.

+ $DCR$, Debt Creation Right : 부채를 만들 수 있는 권리
    $$
    DCR_q := EPB_q - 1
    $$
    + DCR은 보상 수익을 위한 추가 장치입니다. 예치 원금에 대해서도 보상을 받을 것이므로, 목표치에 맞추기 용이하도록 DCR 곡선을 EPB-1로 정의합니다.
    $$
    DCR_{earn} = \int_{q_b}^{q_a} (EPB_q - 1) \, dq = (E(EPB) - 1) \times Amount_{buy}
    $$
    + $Amount_{buy}$ = q_a - q_b$ : 세일즈 참여자가 구매한 토큰 수량
    + $DCR_{earn}$ : 세일즈 참여자가 토큰 구매로 받는 DCR 수량

<!-- 📌 추가 세일즈 참여자의 경우 현재의 Early Staking Pool에서 DCR을 행사할 기회가 없을 수 있습니다. 아래 Priority Reservation 파트를 반드시 참고하세요. -->

---

### EPB / DCR Graph

다음은 Early Staking Pool의 현재 설정값 상에서 판매량(q)에 따른 EPB와 그에 따라 발급되는 "누적" DCR을 시각화 한 그래프입니다.

![KASH EPB Graph](/img/kash_staking_epb.png)

+ q는 1,000,000 KASH 단위입니다.


# Virtual Share

EPB에 의해 발급된 DCR이 실제 보상에 영향을 주는 것은 가상 지분이라는 개념을 통해 구현됩니다.

---

### Virtual Share

사용자는 예치시 DCR을 소모하여 1 DCR당 1 KASH 가치로 환산하여 가상 지분을 발급 받을 수 있습니다. 사용한 DCR 가치 만큼의 부채가 동시에 발생하여, 추후 지분을 청산할 때에 다시 상환해야 합니다. 

+ Virtual Share : DCR에 의해 추가로 발행된 가상 지분입니다. 
    $$
    Share_{virtual} = DCR_{used} \, / \, Price_{share}
    $$
    $$
    Debt_{new} = Debt_{old} + DCR_{used}
    $$
    
즉 가상 지분의 의의는, 이후 보상의 누적에 의한 지분의 가치 상승분을 차익으로 얻을 수 있는데 있습니다. 혹은 더 많은 예치액을 예치하여 더 많은 지분을 가진 것처럼 이자를 받을 수 있다고 해석해도 동일한 의미입니다.

+ Weighted Share : 가상 지분을 포함한 가중 지분입니다. Early Staking Pool에서는 이 가중 지분이 보상 분배의 기준이 됩니다.
    $$
    Share_{weighted} = Share_{principle} + Share_{virtual}
    $$
    + $Share_{principle}$ : 예치 원금에 의해 발행된 순지분

---

### Max Leverage

발급 받은 DCR을 제한 없이 모두 행사할 수 있는 것은 아닙니다. 구매 수량과 발급받은 DCR 개수에 비례하여 최대 부채율(레버리지)가 제한되어 있습니다. 이는 아주 소량의 KASH만 예치하고 DCR만 행사하여 불공정한 형태로 보상을 받는 행위를 방지하기 위한 장치입니다. 

+ User Current Leverage : 특정 유저의 순지분에 비해 총 지분(예치액 규모)이 얼마나 많은가
    $$
    CurrentLeverage_{user} = \frac{Share_{weighed}}{Share_{principle}}
    $$

+ User Max Leverage : 유저가 DCR을 통해 가질 수 있는 최대 레버리지
    $$
    MaxLeverage_{user} = \frac{\sum{DCR_{earned}}}{\sum{Amount_{bought}}} + 1
    $$
    + $\sum{DCR_{earned}}$ : 해당 유저가 수령한 DCR 총량
    + $\sum{Amount_{bought}}$ : 해당 유저가 구매한 KASH 총량

+ Exercisable DCR : 레버리지를 고려해 행사 가능한 DCR 크기
    $$
    Share_{virtual, limit} = (MaxLeverage_{user} - 1) \times (Share_{principle} + \frac{Amount_{deposit}}{Price_{share}})
    $$
    + $Amonut_{deposit}$ : (선택 사항) DCR 행사시 함께 예치할 금액
    + $Share_{virtual, limit}$ : 현재 순지분에 대한 가상 지분의 한도
    $$
    DCR_{exercisable} = 
    \begin{cases}
        0 & (Share_{virtual, limit} <= Share_{virtual}) \\
        (Share_{virtual, limit} - Share_{virtual}) \times Price_{share}  & (else)
    \end{cases}
    $$

일반적으로는 이러한 수식을 모두 이해할 필요 없이, 세일즈로 구매한 토큰 전부를 예치하면 해당 구매로 발급받은 DCR을 모두 행사 가능합니다.

---

### Formula Modification

Early Staking Pool에서는 이 가상 지분 개념을 도입함으로써 다음과 같은 몇가지 차이점이 있습니다.

+ 일반적인 스테이킹 풀에서 Share가 사용되는 몇가지 장소, 특히 보상 계산시에 Weighted Share가 사용됩니다.
+ 스테이킹 풀의 Pool Balance에 사용자에게 회수할 Debt만큼 더 존재한다고 가정합니다.

이를 적용하여 아래와 같이 몇가지 수식이 변경됩니다.

+ Share Price : 각 지분 하나가 나타내는 가치입니다. 진입시나 청산시 이 가격을 기준으로 KASH와 교환됩니다.
    $$
    Price_{share} = \frac{
        \sum Principle_{All users} + 
        \sum Debt_{\text{All users}} + 
        \sum Reward_{\text{All epochs}}
    }{\sum\limits_{user \in U} Shares_{weighted, user}}
    $$
    + $Pool_{principles}$ : 스테이킹한 유저들의 원금 총액입니다.
    + $TotalDebt$ : 스테이킹한 유저들의 부채 총량입니다.
    + $Pool_{rewards}$ : 스테이킹 풀에 실현된 보상 총량입니다.
    + $TotalWeightedShare$ : 스테이킹한 유저들의 가중 지분 총량입니다.

+ Withdrawable Balance : 출금시에는 지분을 소각하고 KASH로 변환합니다. 그 중에서 부채를 제외한 만큼이 인출 가능 금액이 됩니다.
    $$
    Amount_{Withdrawable} = Share_{weighted} \times Price_{share} - Debt
    $$
    + 부분 인출시 유저는 현재의 레버리지를 유지해야 합니다. 따라서 순지분과 가상 지분을 현재 비율과 동일한 비율로 소각해야하며, 부채도 동일 비율 상환해야 합니다.
    $$
    Rate_{burn} = \frac{Amount_{withdraw}}{(Share_{weighted} \times Price_{share}) - Debt_{current}}
    $$
    $$
    Share_{burn} = Amount_{withdraw} \times  \frac{Share_{weighted}}{Share_{weighted} \times Price_{share} - Debt_{current}} = Share_{weighted} * Rate_{burn}
    $$
    + $Amount_{withdraw}$ : 사용자가 인출을 희망하는 금액
    + $Share_{burn}$ : 해당 금액을 인출하기 위해 소각할 지분 수량
    + $Debt_{burn}$ : 해당 지분을 소각하기 위해 상환할 부채

# Advanced Guide

Early Staking Pool은 핵심 개념이라 할 수 있는 EPB/DCR, 가상 지분 외에도 여러가지 특징이 있습니다.

---

### Guaranteed Minimum Reward

아래 보장이라는 표현은 초기 세일즈 참여자가 즉시 모든 토큰과 DCR을 스테이킹하고 보상 분배 종료시까지 참여하는 경우에 한합니다.

+ Early Staking Pool의 가중 지분 발행량이 제한되어 있습니다 : 30m
+ Early Staking Pool에 할당된 보상의 총량이 정해져 있습니다 : 30m
+ 초기 세일즈에 의해 발행되는 DCR의 총량이 정해져 있습니다 : 25m

이로 인해 1 가중 지분은 최소한 1 KASH 이상의 보상을 반드시 분배 받으므로, DCR 하나가 잠재적으로 1 KASH의 미래 수익을 보장하게 됩니다. 

+ 초기 세일즈시 지분 가격이 정해져 있습니다 : 1 KASH / Share
+ 초기 세일즈의 모든 판매된 토큰과 발행된 DCR이 예치 가능합니다 : 5m, 25m

곧 초기 세일즈 참여자들은 자신의 EPB에 해당하는 배율만큼 수익률을 보장받습니다.

단, Epoch가 한번 이상 경과된 후에 참여하는 사용자의 경우에는 가중 지분 하나가 수령 가능한 1 KASH의 이자중 일부가 이미 지급된 상황입니다. 또한 가중 지분 하나의 가격이 1 KASH 이상으로 올라 있습니다. 따라서 가중 지분 하나가 1 KASH 만큼의 추가 이자를 보장하지는 않지만, 그럼에도 참여 시점에 따른 잔여 보상을 기준으로 최소 수익을 계산하여 보장받을 수 있습니다.

📌 여기에서 최저 수익률은 프로젝트가 정상적으로 진행되었을 때, 수학적으로 KASH 단위 토큰 수량의 증가량을 보장하는 것입니다. 프로토콜은 KASH의 리저브에 기반하여 가치를 안정적으로 부양하는 것을 목표로 하지만, 일시적인 KASH의 가격 하락 등의 리스크 등이 충분히 존재하며, 목표 자산 (FIAT 등) 기준으로 수익을 보장 받는 것이 아닙니다.

---

### Principal Conversion Right

풀이 절반이상 경과($Epoch_{Current} \ge \frac{N_{epochs}}{2}$)하면 사용자는 자신의 지분을 소각하지 않고도 원금을 출금할 수 있는, Principal Conversion Right(PCR)이라는 권리를 행사할 수 있습니다.

+ 세일즈에 참여시 해당 정보 (구매 KASH, 지불 자산, 지불액) 가 기록됩니다.
+ 이후 풀이 절반 경과한 시점부터 PCR 행사가 가능합니다.
+ 이를 행사하면 세일즈 구매 KASH에 해당하는 가치 만큼이 인출 됩니다.
+ 유저의 줄어든 지분 만큼 부채를 발행하여 동일한 수량의 가상 지분으로 대체합니다.
+ 인출한 KASH는 소각하고 최초 지불했던 자산을 돌려받을 수 있습니다.
+ 결과적으로 유저는 원금을 회수하면서 계속해서 스테이킹 이자를 수령할 수 있습니다.

Principle Conversion을 통한 원금 회수시에는 최대 레버리지를 일시적으로 초과하는 것이 가능합니다. 단, 이를 통해 레버리지가 증가한 이후에 추가로 DCR을 행사하려는 경우 새로운 부채를 포함하여 레버리지 조건을 만족해야 합니다.

주의할 점으로, PCR은 부분적으로 행사할 수 없으며 원금 전체에 대해서만 행사 가능합니다. 따라서 일부라도 인출이 발생하면 향후 PCR을 행사할 수 없습니다. 이는 지분을 이용한 복리 시스템의 특성상 원금이라는 개념이 모호하고, 이를 추적하는데 과도한 복잡성이 발생함에 기인한 정책입니다. 

---

### Staking Reservation

Early Staking Pool의 토큰 예치량은 가중 지분 기준으로 제한되어 있습니다. 그리고 이 제한은 초기 세일즈 수량 및 이에 의해 발행되는 DCR 수량과 일치하게 설계 되었습니다. 따라서 초기 세일즈 물량에 대해서는 전량 스테이킹 참여가 가능하지만, 이외의 경우 중도 이탈이 생기기는 경우에 한해 참여가 가능합니다.

프로토콜에서는 이 중도 이탈로 인해 스테이킹이 가능한 시점에 자동으로 스테이킹에 참여할 수 있도록 예약을 지원합니다. 예약을 위해서는 희망하는 만큼의 KASH를 예약풀에 미리 예치해 두어야 합니다. 

각 Epoch의 마지막, 보상이 계산되기 직전에 Keeper에 의해 대기 순번 순으로 예치 예약이 실현됩니다. 이는 스테이킹 풀의 예치 한도 내에서만 이루어지며, 경우에 따라 희망한 금액의 일부만 부분적으로 실현될 수 있습니다. 이 경우 나머지 금액에 대해서는 최우선 순위 상태의 예약으로 남겨집니다.

유저는 예약이 실현 되기 전 언제든 취소하고 KASH를 회수할 수 있으나, 추후 다시 예약을 원하는 경우 순번을 다시 기다려야 합니다. 이는 부분 회수시에도 마찬가지로, 부분 회수 후 남은 예약 수량에 대해서는 순번이 유지 되지만, 회수한 KASH를 다시 기존 순번에 추가할 수는 없습니다.

스테이킹 예약 풀에 예약이 존재하는 경우, 직접 스테이킹에 참여할 수 없습니다. 지분 한도가 예약 수량보다 많고, 즉시 스테이킹을 희망하는 경우에는 유저가 직접 예약 실현 함수를 실행하는 트랜젝션을 일으킬 수도 있습니다.