---
sidebar_position: 1
---

# Core Principles

KASH 스테이킹 메커니즘은 다음과 같은 핵심 개념을 근간으로 설계되었습니다.

---

### Staking Pool

KASH 1차 생태계에서 스테이킹 보상 풀에 분배된 KASH는, 프로토콜의 전략에 따라 여러 차례에 걸쳐 별도의 스테이킹 풀에 분배될 수 있습니다.

+ 각 스테이킹 풀마다 보상 총량, 보상 주기 간격, Early Bonus Factor 수식 등이 별도로 설정될 수 있습니다.
+ 각 풀끼리는 서로 독립된 관계로 각자의 보상은 해당 풀 내에 예치한 유저만을 대상으로 합니다.
+ 풀을 선택하여 예치하는 것에는 제한이 없지만, 다른 풀에 예치하기 위해 기존의 포지션을 청산한다면 Early Bonus Factor는 상실하게 됩니다.

---

###  Epoch

KASH의 스테이킹 보상은 실시간, 연속적으로 발생하는 것이 아니라 에포크(Epoch) 라고 하는 미리 정의된 시간 주기에 따라 분배됩니다. 각 에포크가 종료되는 시점에 해당 에포크 동안 발생한 총 보상이 계산되어 스테이킹 참여자들에게 할당됩니다.

+ Genesis Timestamp
    + 스테이킹 풀이 생성되는 즉시 보상 분배가 시작되는 것은 아닙니다. 펀드 레이징 단계에 참여하는 초기 참여자들은 보상 분배가 시작되기 전에 스테이킹을 하여 높은 Early Staker Bonus를 확보할 수 있지만, 실제 보상이 분배되는 Epoch는 프로젝트 개시 이후부터 발생합니다.
    + $T_{open}$ : 스테이킹이 오픈되어 예치 가능해지는 시점
    + $T_{start}$ : 보상 분배가 시작되는 첫 Epoch 시점 ($T_{open} \le T_{start}$)   

+ `Epoch Reward`
    + 각 에포크에 분배될 보상액은 에포크마다 성장률($g$)을 적용하여 점진적으로 증가하도록 설계되었습니다. 이는 Early Bonus Factor를 감안하여 초기 생태계를 보다 안정화하고 장기적인 참여를 독려하기 위함입니다. 
    
    + $N_{epochs}$ : 해당 풀의 전체 스테이킹 기간 동안 총 에포크 수
        $$
        N_{epochs} = \frac{Duration_{pool}}{Duration_{epoch}}
        $$
            + $Duration_{pool}$: 해당 풀의 전체 스테이킹 기간. (상수: #STAKING_TOTAL_DURATION)
            + $Duration_{epoch}$: 에포크 주기. (상수: #STAKING_EPOCH_DURATION)

    + $Reward_{base}$ : 전체 보상 총액과 성장률을 고려하여, 첫 번째 에포크에 분배될 기준 보상액을 결정합니다.
        $$
        Reward_{base} = \frac{Reward_{Total} \times g}{(1 + g)^{N_{epochs}} - 1}
        $$
            + $Reward_{Total}$: 1차 KASH 생태계에서 스테이킹 풀에 분배된 토큰 총량.
            + $g$: 에포크당 보상 성장률. 0 이상. 이 값은 상수 `STAKING_REWARD_GROWTH_RATE`로 정의됩니다. (Appendix A 참조)

    + $Reward_{epoch}$: $k$번째 에포크에 분배될 총 보상은 다음과 같습니다. ($1 \le k \le N_{epochs}$)
        $$
        Reward_{epoch} = Reward_{base} \times (1 + g)^{k-1}
        $$

    + 현재 예정된 첫 스테이킹 풀의 $Reward_{epoch}$ 그래프는 다음과 같습니다.
        + (현재 설정에 따른 epoch별 보상액 예상 보여주기)
        <!-- ![Locale Dropdown](./img/localeDropdown.png) -->

---

### Early Staker Bonus

보너스 팩터에 따라 보상 계산시 실제 예치 금액보다 더 많은 금액을 예치한 것으로 취급하여, 결과적으로 더 많은 보상을 얻을 수 있게 해줍니다. 이 값은 시간이 지날수록 낮아지도록 설계 되었습니다. 

다음과 같이 스테이킹 시작 시점에 따라 차등적인 보너스 팩터가 각 스테이킹 포지션에 부여됩니다. 해당 포지션이 유지되는 동안 변경되지 않습니다.

$$
Early Staker Bonus = Bonus_{base} * ln(
    \frac{Bonus_{decay}}{T_{position} - T_{open} + 1}
)
$$
    + $T_{position}$ : 유저의 스테이킹 시점 (블록 타임스탬프)
    + $T_{open}$ : 스테이킹 오픈 시점 (블록 타임스탬프) #STAKING_OPEN_TIMESTAMP
    + $Bonus_{base}$ : 기준 보너스 값 #STAKING_BONUS_BASE
    + $Bonus_{decay}$ : 생성 시점에 따른 감소량을 조절하는 값 #STAKING_BONUS_DECAY


(현재 설정에 따라, 시간에 따른 Early Staker Bonus 그래프 보여주기)

---

### Staking Reward

+ `Weighted Staking Amount`
    + 실제 예치량에 보너스 팩터를 적용한 가중 스테이킹 수량이 보상 계산의 기준이 됩니다.
    $$
    Weighted Staking Amount = Actual Staking Amount * (1 + Early Staker Bonus)
    $$ 
        + Actual Staking Amount : 포지션에 예치한 토큰 수량

+ `Position Staking Reward`
    + 개별 포지션의 스테이킹 보상은 에포크 보상과 가중 수량 지분에 비례하여 분배합니다. 
    $$
        \text{Reward}_{\text{Position}} = \frac{\text{Weighted Staking Amount}_{\text{Position}}}{\sum \text{Weighted Staking Amount}_{\text{All Positions}}} * \text{Reward}_{\text{Epoch,k}}
    $$

---

### Staking Position

사용자의 스테이킹 활동은 개별적인 스테이킹 포지션(Staking Position) 단위로 기록 및 관리됩니다. 각 포지션은 독립적인 스테이킹 계약으로 간주될 수 있습니다. 사용자는 여러 개의 포지션을 동시에 보유할 수 있습니다.

+ 포지션 속성
    + 하나의 포지션은 다음과 같은 정보를 직간접적으로 담고 있습니다.
    + Staking Pool ID : 스테이킹 한 풀 ID
    + Initial Staking Amount : 최초 스테이킹한 토큰 수량 (KASH)
    + Early Staker Bonus : 최초 스테이킹 시 결정된 보너스 팩터
    + Current Position Amount : 현재 포지션 크기 (KASH)

+ 포지션 변경
    + 사용자는 언제든지 포지션에 예치된 수량의 일부 또는 전체를 인출할 수 있습니다. 이 때 포지션이 완전히 청산되지 않으면, Early Staker Bonus는 유지됩니다.
    + 기존 포지션에 KASH 토큰을 추가로 예치하는 것은 불가능합니다. 단 해당 포지션에서 발생한 이자에 한해 자동으로 예치량에 추가됩니다.
    + 동일한 스테이킹 풀이라도, 추가 예치시 해당 시점에 해당하는 Early Staker Bonus가 적용되는 별도의 포지션이 생성됩니다.

+ NFT (선택사항)
    + 각 포지션은 NFT로 발급되어 소유자에게 전달됩니다.
    + NFT 전송시, 포지션에 포함된 이자 등을 포함한 모든 권리가 이동됩니다.
    + 포지션(NFT)을 직접 거래함으로서, 사용자는 Early Staker Bonus를 잃지 않으면서 포지션을 청산할 수 있습니다.

<!-- + `Switching Fee`
    + 사용자는 포지션의 이자를 즉시 수령과 자동 재스테이킹 사이에서 변경할 수 있습니다.
    + 최초 포지션 생성 이후 이를 변경할 때, 현재까지 발생한 이자는 과거 설정에 따라 정산되며 포지션 규모에 비례하여 Switching Fee가 발생합니다.
    $$
    Fee_{switch} = {Weighted Staking Amount} \times FeeRate_{switch}
    $$
        + $FeeRate_{switch}$: Switching Fee의 비율 (상수: #STAKING_SWITCHING_FEE) -->
