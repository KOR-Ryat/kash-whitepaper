<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KASH ìŠ¤í…Œì´í‚¹ ìµœì†Œ ì˜ˆìƒ ìˆ˜ìµ ê³„ì‚°ê¸°</title>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: auto;
        }
        h1, h2 {
            color: #2c3e50;
            text-align: center;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input[type="number"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .results, .assumptions {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .assumptions ul {
            padding-left: 20px;
        }
        .assumptions li {
            margin-bottom: 8px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        th {
            background-color: #ecf0f1;
            text-align: center;
        }
        .highlight {
            font-weight: bold;
            color: #e74c3c;
        }
        .note {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 15px;
        }
        .error-message {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>KASH ìŠ¤í…Œì´í‚¹ ìµœì†Œ ì˜ˆìƒ ìˆ˜ìµ ê³„ì‚°ê¸°</h1>

        <div class="assumptions">
            <h2>ğŸ“ ê³„ì‚°ê¸° ì£¼ìš” ê°€ì • ë° ì°¸ê³ ì‚¬í•­</h2>
            <ul>
                <li>ì´ ê³„ì‚°ê¸°ëŠ” KASH ìŠ¤í…Œì´í‚¹ í’€ì´ ìµœëŒ€ ìš©ëŸ‰ (3,500ë§Œ Weighted Share)ìœ¼ë¡œ ì™„ì „íˆ ì±„ì›Œì¡Œì„ ë•Œë¥¼ ê°€ì •í•œ <strong>ìµœì†Œ ë³´ì¥ ìˆ˜ìµ</strong>ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì‹¤ì œ í’€ ìƒí™©ì— ë”°ë¼ ìˆ˜ìµì€ ì´ë³´ë‹¤ ë†’ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li>EPB(ì´ˆê¸° ì°¸ì—¬ ë³´ë„ˆìŠ¤ ë°°ìœ¨) ê³„ì‚°ì€ KASH ëˆ„ì  íŒë§¤ëŸ‰ 500ë§Œ ê°œê¹Œì§€ì˜ íŠ¹ì • ìˆ˜ì‹ì„ ë”°ë¥´ë©°, ì‚¬ìš©ìì˜ ì „ì²´ êµ¬ë§¤ê°€ ì´ ë²”ìœ„ ë‚´ì—ì„œ ì´ë£¨ì–´ì§„ë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤. <strong>êµ¬ë§¤ ì‹œì  + êµ¬ë§¤ ìˆ˜ëŸ‰ì´ 500ë§Œ KASHë¥¼ ì´ˆê³¼í•˜ëŠ” ê²½ìš°, ì´ˆê³¼ë¶„ì— ëŒ€í•œ EPBëŠ” í˜„ì¬ ê³„ì‚°ê¸°ì— ë°˜ì˜ë˜ì§€ ì•Šì•„ DCRì´ ë‚®ê²Œ ê³„ì‚°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong></li>
                <li>ê³„ì‚°ëœ ë³´ìƒì€ KASH í† í° ìˆ˜ëŸ‰ ê¸°ì¤€ì´ë©°, KASH í† í°ì˜ ì‹œì¥ ê°€ê²© ë³€ë™ì€ ê³ ë ¤ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</li>
                <li>ëª¨ë“  ë³´ìƒì€ í•´ë‹¹ ì—í¬í¬ê°€ ì¢…ë£Œë˜ëŠ” ì‹œì ì— ë¶„ë°°ë˜ëŠ” ê²ƒìœ¼ë¡œ ê°€ì •í•©ë‹ˆë‹¤. 1 ì—í¬í¬ëŠ” ì•½ 1ê°œì›”ì´ë©°, ì´ 36 ì—í¬í¬(3ë…„) ê°„ì˜ ë³´ìƒì„ ê³„ì‚°í•©ë‹ˆë‹¤.</li>
                <li>ì—í¬í¬ë³„ ë³´ìƒ ì„±ì¥ë¥ (g)ì€ 5% (0.05)ë¡œ ê³ ì •ë©ë‹ˆë‹¤.</li>
                <li>ì‚¬ìš©ìê°€ êµ¬ë§¤í•œ KASHëŠ” ì „ëŸ‰ ì¦‰ì‹œ ìŠ¤í…Œì´í‚¹í•˜ê³ , íšë“í•œ DCRì„ ëª¨ë‘ í–‰ì‚¬í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°€ì •í•©ë‹ˆë‹¤.</li>
                <li><strong>ì›ê¸ˆ íšŒìˆ˜:</strong> 18 ì—í¬í¬(1ë…„ 6ê°œì›”) ê²½ê³¼ í›„ ì›ê¸ˆì„ íšŒìˆ˜í•  ìˆ˜ ìˆìœ¼ë©°, ì´í›„ì—ë„ ì”ì—¬ ì—í¬í¬ì— ëŒ€í•œ ì´ìëŠ” ê³„ì† ì§€ê¸‰ë©ë‹ˆë‹¤. ì´ ê³„ì‚°ê¸°ëŠ” 18 ì—í¬í¬ ì´í›„ "ì›ê¸ˆ í¬í•¨ ì´ ìì‚°"ì—ì„œ ì›ê¸ˆì„ ì œì™¸í•˜ì—¬ ìˆœìˆ˜ ëˆ„ì  ì´ìë§Œ í‘œì‹œí•©ë‹ˆë‹¤.</li>
            </ul>
        </div>

        <div class="input-group">
            <label for="purchaseTiming">KASH êµ¬ë§¤ ì‹œì ì˜ ëˆ„ì  íŒë§¤ëŸ‰ (KASH ë‹¨ìœ„):</label>
            <input type="number" id="purchaseTiming" value="0" min="0" max="4999999">
            <small>ì˜ˆ: 10ë§Œê°œ íŒë§¤ëœ ì‹œì ì— êµ¬ë§¤í•œë‹¤ë©´ 100000 ì…ë ¥. (ìµœëŒ€ 4,999,999ê¹Œì§€)</small>
        </div>

        <div class="input-group">
            <label for="purchaseAmount">ì´ë²ˆì— êµ¬ë§¤(í•˜ê³  ìŠ¤í…Œì´í‚¹í• ) KASH ìˆ˜ëŸ‰:</label>
            <input type="number" id="purchaseAmount" value="1000" min="1">
        </div>

        <button onclick="calculateRewards()">ì˜ˆìƒ ìˆ˜ìµ ê³„ì‚°í•˜ê¸°</button>
        <div id="errorMessage" class="error-message"></div>

        <div id="resultsSummary" class="results" style="display:none;">
            <h2>ğŸ“Š ê³„ì‚° ê²°ê³¼ ìš”ì•½</h2>
            <p>í‰ê·  EPB (ì›ê¸ˆ ëŒ€ë¹„ ë³´ë„ˆìŠ¤ ë°°ìœ¨): <strong id="avgEpb"></strong> ë°°</p>
            <p>íšë“ DCR (ë³´ë„ˆìŠ¤ ê°€ìƒ ì˜ˆì¹˜ì•¡): <strong id="dcrEarned"></strong> KASH</p>
            <p>ì´ ìœ íš¨ ì˜ˆì¹˜ì•¡ (êµ¬ë§¤ KASH + DCR): <strong id="totalEffectiveDeposit"></strong> KASH</p>
            <p>ì˜ˆìƒ ì§€ë¶„ìœ¨ (í’€ ìµœëŒ€ ìš©ëŸ‰ ê¸°ì¤€): <strong id="sharePercentage"></strong> %</p>
            <p>36 ì—í¬í¬ (3ë…„) í›„ ì´ ëˆ„ì  ì˜ˆìƒ ì´ì: <strong id="totalCumulativeReward36Epochs" class="highlight"></strong> KASH</p>
             <p>36 ì—í¬í¬ (3ë…„) í›„ ì›ê¸ˆ í¬í•¨ ì´ ì˜ˆìƒ ìì‚° (ì›ê¸ˆì€ 18ì—í¬í¬ í›„ íšŒìˆ˜ ê°€ì •): <strong id="totalAsset36EpochsWithPrincipal" class="highlight"></strong> KASH</p>
        </div>

        <div id="resultsTableContainer" style="display:none; margin-top: 20px;">
            <h2>ğŸ—“ï¸ ì—í¬í¬ë³„ ìƒì„¸ ì˜ˆìƒ ìˆ˜ìµ</h2>
            <table id="rewardsTable">
                <thead>
                    <tr>
                        <th>ì—í¬í¬</th>
                        <th>í•´ë‹¹ ì—í¬í¬ ì´ ë³´ìƒ (í’€ ì „ì²´)</th>
                        <th>ë‚˜ì˜ ì˜ˆìƒ ë³´ìƒ (ì´ë²ˆ ì—í¬í¬)</th>
                        <th>ë‚˜ì˜ ëˆ„ì  ì´ì</th>
                        <th>ì›ê¸ˆ í¬í•¨ ì´ ìì‚°<br>(18 ì—í¬í¬ í›„ ì›ê¸ˆ íšŒìˆ˜ ë°˜ì˜)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ì±„ì›Œì§‘ë‹ˆë‹¤ -->
                </tbody>
            </table>
            <p class="note">* "ì›ê¸ˆ í¬í•¨ ì´ ìì‚°"ì€ 18 ì—í¬í¬ ì´í›„ì—ëŠ” ëˆ„ì  ì´ìë§Œ í‘œì‹œë©ë‹ˆë‹¤ (ì›ê¸ˆì€ íšŒìˆ˜ëœ ê²ƒìœ¼ë¡œ ê°€ì •).</p>
        </div>
    </div>

    <script>
        // --- ì‹œìŠ¤í…œ ê³ ì • ê°’ ---
        const EPB_A = 6.160392620707085906;
        const EPB_k_denom = 0.540906246443305252;
        const EPB_C_add = 3.944556263515440025;

        const TOTAL_EPOCHS = 36;
        // const EPOCHS_PER_YEAR = 12; // ì°¸ê³ ìš©
        const SALES_LIMIT_FOR_EPB_FORMULA = 5000000;
        const TOTAL_POOL_REWARD_KASH = 35000000;
        const EPOCH_REWARD_GROWTH_RATE_G = 0.05;
        const POOL_WEIGHTED_SHARE_CAP = 35000000;

        // EPB ê³„ì‚° í•¨ìˆ˜
        function calculateEpbValue(x) {
            if (x < 0) return EPB_C_add; // xê°€ 0ë³´ë‹¤ ì‘ìœ¼ë©´ ì²« ê°’ìœ¼ë¡œ ì²˜ë¦¬ (í˜¹ì€ ì—ëŸ¬)
            if (x > SALES_LIMIT_FOR_EPB_FORMULA) x = SALES_LIMIT_FOR_EPB_FORMULA; // ìƒí•œ ì œí•œ
            return (EPB_A / Math.pow((x + EPB_k_denom), 2)) + EPB_C_add;
        }

        // EPB ë¶€ì •ì ë¶„ í•¨ìˆ˜ (ìƒìˆ˜í•­ ì œì™¸)
        function calculateEpbIntegral(x) {
            if (x < 0) return EPB_C_add * x; // xê°€ 0ë³´ë‹¤ ì‘ìœ¼ë©´ ì„ í˜•ìœ¼ë¡œ ê·¼ì‚¬ (í˜¹ì€ ì—ëŸ¬)
            if (x > SALES_LIMIT_FOR_EPB_FORMULA) x = SALES_LIMIT_FOR_EPB_FORMULA; // ìƒí•œ ì œí•œ
            return (-EPB_A / (x + EPB_k_denom)) + (EPB_C_add * x);
        }

        function calculateRewards() {
            document.getElementById('errorMessage').textContent = ''; // Clear previous errors
            const purchaseTimingInput = document.getElementById('purchaseTiming');
            const purchaseAmountInput = document.getElementById('purchaseAmount');

            let q_b = parseFloat(purchaseTimingInput.value);
            let user_purchase_kash_amount = parseFloat(purchaseAmountInput.value);

            // ì…ë ¥ê°’ ìœ íš¨ì„± ê²€ì‚¬
            if (isNaN(q_b) || q_b < 0) {
                document.getElementById('errorMessage').textContent = "êµ¬ë§¤ ì‹œì  ëˆ„ì  íŒë§¤ëŸ‰ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš” (0 ì´ìƒ).";
                return;
            }
            if (isNaN(user_purchase_kash_amount) || user_purchase_kash_amount <= 0) {
                document.getElementById('errorMessage').textContent = "êµ¬ë§¤ KASH ìˆ˜ëŸ‰ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš” (0ë³´ë‹¤ ì»¤ì•¼ í•¨).";
                return;
            }

            if (q_b >= SALES_LIMIT_FOR_EPB_FORMULA) {
                 document.getElementById('errorMessage').textContent = `ê²½ê³ : êµ¬ë§¤ ì‹œì (${q_b.toLocaleString()} KASH)ì´ EPB ìˆ˜ì‹ ì ìš© í•œë„(${SALES_LIMIT_FOR_EPB_FORMULA.toLocaleString()} KASH)ë¥¼ ì´ë¯¸ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° DCRì€ 0ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.`;
                q_b = SALES_LIMIT_FOR_EPB_FORMULA; // í•œë„ ì´ˆê³¼ì‹œ DCR 0 ìœ ë„
            }
            
            let q_a = q_b + user_purchase_kash_amount;
            let dcr_note = "";

            if (q_a > SALES_LIMIT_FOR_EPB_FORMULA) {
                dcr_note = ` (ì°¸ê³ : êµ¬ë§¤ í›„ ëˆ„ì  íŒë§¤ëŸ‰(${q_a.toLocaleString()} KASH)ì´ EPB ìˆ˜ì‹ í•œë„ë¥¼ ì´ˆê³¼í•˜ì—¬, ${SALES_LIMIT_FOR_EPB_FORMULA.toLocaleString()} KASHê¹Œì§€ë§Œ DCRì´ ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.)`;
                q_a = SALES_LIMIT_FOR_EPB_FORMULA;
            }
            
            // 1. ì‚¬ìš©ì DCR ê³„ì‚°
            let user_dcr_earned = 0;
            if (q_a > q_b) { // êµ¬ë§¤ëŸ‰ì´ ìˆì–´ì•¼ DCR ë°œìƒ
                 user_dcr_earned = calculateEpbIntegral(q_a) - calculateEpbIntegral(q_b);
            }
             if (user_dcr_earned < 0) user_dcr_earned = 0; // í˜¹ì‹œ ëª¨ë¥¼ ìŒìˆ˜ ë°©ì§€

            // 2. ì‚¬ìš©ì í‰ê·  EPB
            const user_average_epb = user_purchase_kash_amount > 0 ? (user_dcr_earned / user_purchase_kash_amount) : 0;

            // 3. ì‚¬ìš©ì ì´ ìœ íš¨ ì˜ˆì¹˜ì•¡
            const user_total_effective_deposit = user_purchase_kash_amount + user_dcr_earned;

            // 4. ì‚¬ìš©ì ì§€ë¶„ìœ¨
            const user_share_percentage = user_total_effective_deposit / POOL_WEIGHTED_SHARE_CAP;

            // 5. ì—í¬í¬ë³„ ì´ ë³´ìƒëŸ‰ ê³„ì‚°
            let reward_base_for_epoch;
            if (EPOCH_REWARD_GROWTH_RATE_G === 0) {
                reward_base_for_epoch = TOTAL_POOL_REWARD_KASH / TOTAL_EPOCHS;
            } else {
                reward_base_for_epoch = (TOTAL_POOL_REWARD_KASH * EPOCH_REWARD_GROWTH_RATE_G) / (Math.pow(1 + EPOCH_REWARD_GROWTH_RATE_G, TOTAL_EPOCHS) - 1);
            }

            const epoch_total_rewards_array = [];
            for (let k = 1; k <= TOTAL_EPOCHS; k++) {
                epoch_total_rewards_array.push(reward_base_for_epoch * Math.pow(1 + EPOCH_REWARD_GROWTH_RATE_G, k - 1));
            }

            // --- ê²°ê³¼ í‘œì‹œ ---
            document.getElementById('resultsSummary').style.display = 'block';
            document.getElementById('avgEpb').textContent = user_average_epb.toFixed(4);
            document.getElementById('dcrEarned').textContent = user_dcr_earned.toLocaleString(undefined, {maximumFractionDigits: 2}) + dcr_note;
            document.getElementById('totalEffectiveDeposit').textContent = user_total_effective_deposit.toLocaleString(undefined, {maximumFractionDigits: 2});
            document.getElementById('sharePercentage').textContent = (user_share_percentage * 100).toFixed(6);

            // ì—í¬í¬ë³„ í…Œì´ë¸” ìƒì„±
            const tableBody = document.getElementById('rewardsTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì‚­ì œ

            let user_cumulative_reward = 0;
            let user_total_asset_with_principal = user_purchase_kash_amount;

            // Epoch 0 (ì‹œì‘ ì‹œì )
            let row = tableBody.insertRow();
            row.insertCell().textContent = 0;
            row.insertCell().textContent = (0).toLocaleString(undefined, {maximumFractionDigits: 2});
            row.insertCell().textContent = (0).toLocaleString(undefined, {maximumFractionDigits: 2});
            row.insertCell().textContent = (0).toLocaleString(undefined, {maximumFractionDigits: 2});
            row.insertCell().textContent = user_total_asset_with_principal.toLocaleString(undefined, {maximumFractionDigits: 2});

            let principal_recovered = false;

            for (let k = 1; k <= TOTAL_EPOCHS; k++) {
                const current_epoch_total_reward_for_pool = epoch_total_rewards_array[k-1];
                const user_reward_this_epoch = user_share_percentage * current_epoch_total_reward_for_pool;
                user_cumulative_reward += user_reward_this_epoch;

                if (k > 18 && !principal_recovered) {
                    // 18 ì—í¬í¬ *ì´í›„* (ì¦‰, 19 ì—í¬í¬ë¶€í„°) ì›ê¸ˆ íšŒìˆ˜ë¥¼ ë°˜ì˜
                    // user_total_asset_with_principal -= user_purchase_kash_amount; // ì´ ê³„ì‚° ë°©ì‹ë³´ë‹¤ëŠ” ì•„ë˜ ë°©ì‹ì´ ë” ëª…í™•
                    principal_recovered = true;
                }
                
                if (principal_recovered) {
                    user_total_asset_with_principal = user_cumulative_reward; // ì›ê¸ˆ íšŒìˆ˜ í›„ì—ëŠ” ëˆ„ì  ì´ìë§Œ ìì‚°
                } else {
                    user_total_asset_with_principal = user_purchase_kash_amount + user_cumulative_reward;
                }


                row = tableBody.insertRow();
                row.insertCell().textContent = k;
                row.insertCell().textContent = current_epoch_total_reward_for_pool.toLocaleString(undefined, {maximumFractionDigits: 2});
                row.insertCell().textContent = user_reward_this_epoch.toLocaleString(undefined, {maximumFractionDigits: 4});
                row.insertCell().textContent = user_cumulative_reward.toLocaleString(undefined, {maximumFractionDigits: 2});
                row.insertCell().textContent = user_total_asset_with_principal.toLocaleString(undefined, {maximumFractionDigits: 2});

                if (k === 18 && !principal_recovered) { // 18 ì—í¬í¬ ì¢…ë£Œ ì‹œì ì— ì›ê¸ˆíšŒìˆ˜ í‘œì‹œ
                     let noteCell = row.insertCell();
                     noteCell.textContent = " (ì›ê¸ˆ íšŒìˆ˜ ì‹œì )";
                     noteCell.colSpan = 1; // A bit of a hack, but for display purpose
                     noteCell.style.fontWeight = "bold";
                     noteCell.style.color = "green";
                }
            }
            
            document.getElementById('totalCumulativeReward36Epochs').textContent = user_cumulative_reward.toLocaleString(undefined, {maximumFractionDigits: 2});
             // 36 ì—í¬í¬ í›„ ì´ ìì‚°ì€ ì´ë¯¸ ì›ê¸ˆ íšŒìˆ˜ê°€ ë°˜ì˜ëœ ëˆ„ì  ì´ìì™€ ë™ì¼ (principal_recoveredê°€ trueì¼ ê²ƒì´ë¯€ë¡œ)
            document.getElementById('totalAsset36EpochsWithPrincipal').textContent = user_total_asset_with_principal.toLocaleString(undefined, {maximumFractionDigits: 2});


            document.getElementById('resultsTableContainer').style.display = 'block';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ê³„ì‚° (ì˜µì…˜)
        // window.onload = calculateRewards;
    </script>
</body>
</html>